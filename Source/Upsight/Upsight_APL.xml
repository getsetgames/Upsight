<?xml version="1.0" encoding="utf-8"?>
<!-- Upsight Android documentation available at http://help.upsight.com/api_sdk_reference/android/#analytics-module-dependencies -->
<root xmlns:android="http://schemas.android.com/apk/res/android">
	<!-- init section is always evaluated once per architecture -->
	<init>
		<log text="Upsight init"/>
		<setStringFromProperty result="sUpsightAppToken"       ini="Engine" section="/Script/Upsight.UpsightSettings" property="ApplicationToken"       default=""/>
		<setStringFromProperty result="sUpsightPublicKey"      ini="Engine" section="/Script/Upsight.UpsightSettings" property="PublicKey"              default=""/>
	</init>

	<!-- optional updates applied to AndroidManifest.xml -->
	<androidManifestUpdates>

		<setElement    result="upsight-meta-data-app-token"  value="meta-data"/>
	    <addAttribute     tag="$upsight-meta-data-app-token"  name="android:name"  value="com.upsight.app_token"/>
	    <addAttribute     tag="$upsight-meta-data-app-token"  name="android:value" value="$S(sUpsightAppToken)"/>
    	<addElement       tag="application"                   name="upsight-meta-data-app-token"/>

		<setElement    result="upsight-meta-data-pub-key"  value="meta-data"/>
	    <addAttribute     tag="$upsight-meta-data-pub-key"  name="android:name"  value="com.upsight.public_key"/>
	    <addAttribute     tag="$upsight-meta-data-pub-key"  name="android:value" value="$S(sUpsightPublicKey)"/>
    	<addElement       tag="application"                 name="upsight-meta-data-pub-key"/>

 		<setElement    result="upsight-provider"  value="provider"/>
	    <addAttribute     tag="$upsight-provider"  name="android:name"        value="com.upsight.android.internal.persistence.ContentProvider"/>
	    <addAttribute     tag="$upsight-provider"  name="android:authorities" value="$S(PackageName).upsight"/>
	    <addAttribute     tag="$upsight-provider"  name="android:enabled"     value="true"/>
	    <addAttribute     tag="$upsight-provider"  name="android:exported"    value="false"/>
    	<addElement       tag="application"        name="upsight-provider"/>

    	<addElements tag="application">
        	<meta-data android:name="com.upsight.extension.analytics" android:value="com.upsight.android.UpsightAnalyticsExtension" />
			<service   android:name="com.upsight.android.analytics.internal.DispatcherService" />

 			<receiver android:name="com.upsight.android.analytics.internal.dispatcher.schema.NetworkChangeBroadcastReceiver" >
            	<intent-filter>
                	<action android:name="android.net.conn.CONNECTIVITY_CHANGE" />
            	</intent-filter>
        	</receiver>

        	<meta-data android:name="com.upsight.core" android:value="com.upsight.android.internal.CoreComponentFactory" />
    	</addElements>

	</androidManifestUpdates> 

	<!-- optional additions to proguard -->
	<proguardAdditions>
		<insert>
<![CDATA[
		-keep class com.squareup.otto.Bus
		-keep class rx.** { *; }
		-keep class dagger.** { *; }
		-keep class android.support.v4.** { *; }
		-keep class com.google.android.gms.** { *; }
		-keep class rx.android.schedulers.HandlerScheduler

		# Upsight
		-keep class com.upsight.android.** { *; }
		-keep interface com.upsight.android.** { *; }

		# Upsight Mediation
		-dontwarn com.nuance.nmdp.speechkit.**
		-dontwarn com.google.ads.**
		-dontwarn android.webkit.**
		-dontwarn android.support.v4.**
		-dontwarn com.unity3d.**
		-keep class com.upsight.mediation.** { *; }
		-keep class com.vungle.** { *; }
		-keep class javax.** { *; }
		-keepattributes JavascriptInterface
		-keepattributes *Annotation*
		-keep class sun.misc.Unsafe { *; }
		-keepattributes Signature

		# Jackson
		-dontwarn com.fasterxml.jackson.databind.**
		-keepattributes *Annotation*,EnclosingMethod,Signature
		-keepnames class com.fasterxml.jackson.** { *; }
		-keepclassmembers public final enum com.fasterxml.jackson.annotation.JsonAutoDetect$Visibility {
		    public static final com.fasterxml.jackson.annotation.JsonAutoDetect$Visibility *;
		}

		# Rx
		-dontwarn sun.misc.**
		-keep class rx.schedulers.Schedulers {
		    public static <methods>;
		}
		-keep class rx.schedulers.ImmediateScheduler {
		    public <methods>;
		}
		-keep class rx.schedulers.TestScheduler {
		    public <methods>;
		}
		-keep class rx.schedulers.Schedulers {
		    public static ** test();
		}
		-keepclassmembers class rx.internal.util.unsafe.*ArrayQueue*Field* {
		    long producerIndex;
		    long consumerIndex;
		}
		-keepclassmembers class rx.internal.util.unsafe.BaseLinkedQueueProducerNodeRef {
		    long producerNode;
		    long consumerNode;
		}
]]>
		</insert>
	</proguardAdditions>
	
	<!-- optional files or directories to copy to Intermediate/Android/APK -->
 	<prebuildCopies>
		<copyDir src="$S(EngineDir)/Plugins/GSG/Upsight/lib/Android/libs"     dst="$S(BuildDir)/libs" />
		<copyDir src="$S(EngineDir)/Plugins/GSG/Upsight/lib/Android/JavaLibs" dst="$S(EngineDir)/Build/Android/Java/JavaLibs" />
	</prebuildCopies>

	<!-- optional additions to the GameActivity imports in GameActivity.java -->
	<gameActivityImportAdditions>
		<insert>
import com.upsight.android.*;
		</insert>
	</gameActivityImportAdditions>
	

	<!-- optional additions to the GameActivity class in GameActivity.java -->
	<gameActivityClassAdditions>
		<insert>
private UpsightContext mUpsight;
		</insert>
	</gameActivityClassAdditions>
	
	<!-- optional additions to GameActivity onCreate metadata reading in GameActivity.java -->
	<gameActivityReadMetadataAdditions>

	</gameActivityReadMetadataAdditions>
	
	<!-- optional additions to GameActivity onCreate in GameActivity.java -->
	<gameActivityOnCreateAdditions>
		<insert>
mUpsight = Upsight.createContext(this.getApplicationContext());
		</insert>
	</gameActivityOnCreateAdditions>

	<!-- optional additions to GameActivity onDestroy in GameActivity.java -->
	<gameActivityOnDestroyAdditions>
		<insert>
		
		</insert>
	</gameActivityOnDestroyAdditions>
	
	
	<!-- optional additions to GameActivity onStart in GameActivity.java -->
	<gameActivityOnStartAdditions>
		<insert>
		
		</insert>
	</gameActivityOnStartAdditions>

	<!-- optional additions to GameActivity onStop in GameActivity.java -->
	<gameActivityOnStopAdditions>
		<insert>

		</insert>
	</gameActivityOnStopAdditions>
	

	<!-- optional additions to GameActivity onPause in GameActivity.java	-->
	<gameActivityOnPauseAdditions>
		<insert>

		</insert>
	</gameActivityOnPauseAdditions>


	<!-- optional additions to GameActivity onResume in GameActivity.java	-->
	<gameActivityOnResumeAdditions>
		<insert>

		</insert>
	</gameActivityOnResumeAdditions>


	<!-- optional additions to GameActivity onActivityResult in GameActivity.java -->
	<gameActivityOnActivityResultAdditions><![CDATA[
void AndroidThunkJava_UpsightRecordAnalyticsEventWithName(String eventName, String[] keys, String[] values)
{
	var b = UpsightCustomEvent.createBuilder(eventName);

	for (int i = 0; i < keys.length; i++)
	{
		b = b.put(keys[i], values[i]);
    }

    b.record(mUpsight);

}
void AndroidThunkJava_UpsightRecordMilestoneEventForScope(String scope, String[] keys, String[] values)
{
	var b = UpsightMilestoneEvent.createBuilder(scope);

	for (int i = 0; i < keys.length; i++)
	{
		b = b.put(keys[i], values[i]);
    }

	b.record(mUpsight);
}
]]>
	</gameActivityOnActivityResultAdditions>
	

	<!-- optional libraries to load in GameActivity.java before libUE4.so -->
	<soLoadLibrary>

	</soLoadLibrary>
</root>
